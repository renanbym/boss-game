<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Sin Dragon</title>

    <style>
        body {
            background: #262626;
            overflow: hidden;
        }

        canvas {
            border: solid 0.5px rgb(33, 33, 33);
            display: block;
            margin: 0 auto;
        }
    </style>

    <script src="grid.js"></script>
    <script src="findPath.js"></script>
    <script src="Background.js"></script>
    <script src="Personagem.js"></script>
    <script src="Vilao.js"></script>
</head>

<body>

    <canvas width="1000" height="1000" id="container"></canvas>

    <script>
        const canvas = document.getElementById('container')
        const context = canvas.getContext('2d')

        const PIXEL = 40;

        const image = new Image()
        image.src = 'img/actor.png'

        const Gunslinger = new Personagem({
            x: 0,
            y: 1 * PIXEL,
            width: 49,
            height: 48,
            velocity: PIXEL,
            context,
            image,
            PIXEL
        })

        const image1 = new Image()
        image1.src = 'img/Villager1.png'

        const Vilao = new Personagem({
            x: 2 * PIXEL,
            y: 15 * PIXEL,
            width: 49,
            height: 48,
            velocity: PIXEL,
            context,
            image: image1,
            walkingTo: Gunslinger,
            villain: false,
            PIXEL
        })

        const BG = new Background({
            canvas,
            context,
            MAP,
            PIXEL,
            images: ['img/bgs.png', 'img/walls.png']
        })

        const render = () => {
            BG.render()
            Gunslinger.render()
            Vilao.render()
        }

        window.onload = render;

        Teclado.call(Gunslinger);

        function Teclado() {
            this.SETA_ESQUERDA = 37;
            this.SETA_CIMA = 38;
            this.SETA_DIREITA = 39;
            this.SETA_BAIXO = 40;
            this.ESPACO = 32;

            this.checkWall = (nextX, nextY) => {
                const find = WALLS.find(wall => wall[0] == nextX / PIXEL && wall[1] == nextY / PIXEL)
                if (find) return false
                return true
            }

            document.addEventListener('keydown', (event) => {

                if (event.keyCode == this.SETA_BAIXO) {

                    const next = this.y + this.velocity
                    if (this.checkWall(this.x, next)) {
                        this.lastPosition = this.SETA_BAIXO;
                        this.y = next > (canvas.height - this.height) ? (canvas.height - this.height) : next;

                        this.nextFrame();
                        this.render()
                        render();
                    }
                }

                if (event.keyCode == this.SETA_CIMA) {

                    const next = this.y - this.velocity
                    if (this.checkWall(this.x, next)) {
                        this.lastPosition = this.SETA_CIMA;
                        this.y = next <= 0 ? 0 : next;

                        this.nextFrame();
                        this.render()
                        render();
                    }
                }

                if (event.keyCode == this.SETA_DIREITA) {
                    const next = this.x + this.velocity
                    if (this.checkWall(next, this.y)) {
                        this.lastPosition = this.SETA_DIREITA;
                        this.x = next > (canvas.height - this.width) ? (canvas.width - this.width) : next;

                        this.nextFrame();
                        this.render()
                        render();
                    }
                }

                if (event.keyCode == this.SETA_ESQUERDA) {
                    const next = this.x - this.velocity
                    if (this.checkWall(next, this.y)) {
                        this.lastPosition = this.SETA_ESQUERDA;
                        this.x = next <= 0 ? 0 : next;

                        this.nextFrame();
                        this.render()
                        render();
                    }
                }

                if (event.keyCode == this.ESPACO) {

                }
            })
        }


    </script>

</body>

</html>